
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Balance de Pesos - Barco Drag√≥n</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="mb-3">üêâ Balance de Pesos ‚Äî Barco Drag√≥n</h1>

  <form method="post" class="card card-body shadow-sm mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-auto">
        <label class="form-label">Tama√±o del bote</label>
        <select name="boat_size" class="form-select" onchange="this.form.submit()">
          <option value="10" {{ 'selected' if boat_size==10 else '' }}>DB10 (5 bancas)</option>
          <option value="20" {{ 'selected' if boat_size==20 else '' }}>DB20 (10 bancas)</option>
        </select>
      </div>
      <div class="col-auto">
        <label class="form-label">Tambor (proa)</label>
        <select name="drummer" class="form-select">
          {% for name, w in paddlers.items() %}
          <option value="{{ name }}" {% if drummer == name %}selected{% endif %}>
            {{ name }}{% if name %} ({{ w }} kg){% endif %}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto">
        <label class="form-label">Tim√≥n (popa)</label>
        <select name="helm" class="form-select">
          {% for name, w in paddlers.items() %}
          <option value="{{ name }}" {% if helm == name %}selected{% endif %}>
            {{ name }}{% if name %} ({{ w }} kg){% endif %}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto ms-auto">
        <button class="btn btn-primary">Calcular balance</button>
        <button class="btn btn-outline-secondary" name="action" value="pdf">Exportar PDF</button>
      </div>
    </div>

    <hr>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead><tr><th>Banca</th><th class="text-center">Babor (L)</th><th class="text-center">Estribor (R)</th></tr></thead>
        <tbody>
        {% for i in range(1, benches+1) %}
          <tr>
            <td>Bench {{ i }}</td>
            <td>
              <select name="L{{ i }}" class="form-select">
                {% for name, w in paddlers.items() %}
                <option value="{{ name }}" {% if weights.get('L' ~ i) == name %}selected{% endif %}>
                  {{ name }}{% if name %} ({{ w }} kg){% endif %}
                </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select name="R{{ i }}" class="form-select">
                {% for name, w in paddlers.items() %}
                <option value="{{ name }}" {% if weights.get('R' ~ i) == name %}selected{% endif %}>
                  {{ name }}{% if name %} ({{ w }} kg){% endif %}
                </option>
                {% endfor %}
              </select>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </form>

  {% if result %}
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header">Proa vs Popa</div>
        <div class="card-body">
          <img src="{{ url_for('static', filename='img/dragon_side.png') }}" class="img-fluid" alt="Vista lateral">
          <div class="mt-3">
            <div class="d-flex justify-content-between small">
              <span>Proa: {{ '%.1f' % result['totals']['bow'] }} kg</span>
              <span>Popa: {{ '%.1f' % result['totals']['stern'] }} kg</span>
            </div>
            <div class="progress"><div class="progress-bar" style="width: {{ result['percents']['bow'] }}%;">Proa {{ result['percents']['bow'] }}%</div></div>
            <div class="text-end small mt-1">Popa {{ result['percents']['stern'] }}%</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header">Babor vs Estribor</div>
        <div class="card-body">
          <img src="{{ url_for('static', filename='img/dragon_top.png') }}" class="img-fluid" alt="Vista superior">
          <div class="mt-3">
            <div class="d-flex justify-content-between small">
              <span>Babor: {{ '%.1f' % result['totals']['left'] }} kg</span>
              <span>Estribor: {{ '%.1f' % result['totals']['right'] }} kg</span>
            </div>
            <div class="progress"><div class="progress-bar" style="width: {{ result['percents']['left'] }}%;">Babor {{ result['percents']['left'] }}%</div></div>
            <div class="text-end small mt-1">Estribor {{ result['percents']['right'] }}%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-4 shadow-sm">
    <div class="card-header">Resumen</div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3"><strong>Palistas:</strong> {{ benches*2 }}</div>
        <div class="col-md-4"><strong>Tambor:</strong> {{ drummer }} ({{ result['totals']['drummer'] }} kg)</div>
        <div class="col-md-4"><strong>Tim√≥n:</strong> {{ helm }} ({{ result['totals']['helm'] }} kg)</div>
        <div class="col-md-12"><strong>Total:</strong> {{ '%.1f' % result['totals']['total'] }} kg</div>
      </div>
      <hr>
      <div class="table-responsive">
        <table class="table table-sm">
          <thead><tr><th>Banca</th><th>Babor (Nombre/Peso)</th><th>Estribor (Nombre/Peso)</th></tr></thead>
          <tbody>
          {% for row in result['assignments'] %}
            <tr>
              <td>{{ row.bench }}</td>
              <td>{{ row.L_name or '-' }} {% if row.L_name %}({{ row.L_w }} kg){% endif %}</td>
              <td>{{ row.R_name or '-' }} {% if row.R_name %}({{ row.R_w }} kg){% endif %}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}

  <footer class="text-center text-muted small mt-4">Hecho por Nelson D√≠az</footer>
</div>
</body>
</html>
